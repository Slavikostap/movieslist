var app=angular.module("moviesApp",["ngRoute","tagged.directives.infiniteScroll","ngStorage"]);app.config(function(e){e.when("/",{templateUrl:"pages/home.html",controller:"movieCtrl"}).when("/:pagename",{templateUrl:"pages/moviedetails.html",controller:"movieCtrl"}).otherwise({redirectTo:"/"})}),app.controller("movieCtrl",["$scope","$http","$routeParams","$timeout","$localStorage",function(e,r,o,a,t){var s=1,i="",c={},n=[],m=[];e.page=o.pagename,e.movies=[],e.year="",e.movieName="all",e.typeOfMovie="",e.errorMessage="",e.savedArray=[],e.savedArray2=[],e.searchMovies=function(){for(s=1,e.requestID=e.movieName+"-"+String(e.year)+"-"+e.typeOfMovie,e.savedArray=t.cache,k=0;k<e.savedArray.length;k++)e.savedArray[k].requestID===e.requestID?e.movies=e.savedArray[k].response:(e.request=!0,r.jsonp("http://www.omdbapi.com/?s="+e.movieName+"&y="+e.year+"&type="+e.typeOfMovie+"&page="+s+"&r=&callback=JSON_CALLBACK").success(function(r){for(e.movies=r.Search,s=0;s<e.movies.length;s++)"N/A"==e.movies[s].Poster&&(e.movies[s].Poster="img.jpg");e.errorMessage=r.Error,s++}).error(function(){alert("An error has occured. Please check your internet connection"),e.request=!1}))},e.addMovies=function(){e.request=!0,r.jsonp("http://www.omdbapi.com/?s="+e.movieName+"&y="+e.year+"&type="+e.typeOfMovie+"&page="+s+"&r=&callback=JSON_CALLBACK").success(function(r){if(i!==r.Search[0].imdbID){for(e.movies=e.movies.concat(r.Search),s=0;s<e.movies.length;s++)"N/A"==e.movies[s].Poster&&(e.movies[s].Poster="img.jpg");i=r.Search[0].imdbID,s++,e.requestID=e.movieName+"-"+String(e.year)+"-"+e.typeOfMovie,c={movieName:e.movieName,year:e.year,type:e.typeOfMovie,requestID:e.requestID,response:e.movies};var o=n.length-1;o>=0&&n[o].requestID===e.requestID?(n.splice(o,1),n.push(c),m=e.savedArray,j=m.length-1,j>=0&&(m.splice(j,1),m.push(c),t.cache=e.savedArray.concat(m),e.savedArray=t.cache)):(n.push(c),t.cache=e.savedArray.concat(n),e.savedArray=t.cache)}}).error(function(r,o){alert("An error has occured. Please check your internet connection"),e.request=!1})},e.resetStorage=function(){t.cache=[],t.chacheMoviInfo=[],alert("Cache has been cleaned.")}}]);var storageArray3=[];app.controller("MovieInfo",["$scope","$http","$routeParams","$timeout","$localStorage",function(e,r,o,a,t){storageArray3=t.chacheMoviInfo,e.showMovieInfo=function(){var r=storageArray3.length-1;if(r>=0){for(i=0;i<=r;i++)o.pagename===storageArray3[i].imdbID&&(e.movieDetails=storageArray3[i],console.log("done without request"));e.movieDetails||e.httpRequest()}else e.httpRequest()},e.httpRequest=function(){console.log("http request");var a=storageArray3.length-1;r.jsonp("http://www.omdbapi.com/?i="+o.pagename+"&plot=short&r=&callback=JSON_CALLBACK").success(function(r){if(e.movieDetails=r,"N/A"==e.movieDetails.Poster&&(e.movieDetails.Poster="img.jpg"),n=-1,a>=0)for(i=0;i<=a;i++)storageArray3[i].imdbID!==r.imdbID&&n++;n===a&&storageArray3.push(r),t.chacheMoviInfo=storageArray3}).error(function(){alert("An error has occured. Please check your internet connection")})},e.showMovieInfo()}]);